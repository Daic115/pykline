<!DOCTYPE html>
<html lang="cn">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <meta
      name="theme-color"
      content="#000000"
    />
    <meta
      name="keywords"
      content="Quick Start"
    />
    <meta
      name="description"
      content="Quick Start"
    />
    <title>Quick Start</title>
    <script src="https://cdn.jsdelivr.net/npm/klinecharts@10.0.0-alpha5/dist/umd/klinecharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body>
    <div
      id="chart"
      class="w-full h-screen"
    ></div>
    <script>
      window.onload = function () {
        var chart = klinecharts.init("chart");
        klinecharts.registerIndicator({
          name: "customIndicatorBasic",
          shortName: "Basic",
          series: "price",
          figures: [
            {
              key: "close",
              title: "close: ",
              type: "line",
            },
          ],
          calc: (dataList) => dataList.map((data) => ({ close: data.close })),
        });

        klinecharts.registerFigure({
          name: "diamond",
          draw: (ctx, attrs, styles) => {
            const { x, y, width, height } = attrs;
            const { color } = styles;
            ctx.beginPath();
            ctx.moveTo(x - width / 2, y);
            ctx.lineTo(x, y - height / 2);
            ctx.lineTo(x + width / 2, y);
            ctx.lineTo(x, y + height / 2);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
          },
          checkEventOn: (coordinate, attrs) => {
            const { x, y } = coordinate;
            const { width, height } = attrs;
            return (
              Math.abs(x * height) + Math.abs(y * width) <= (width * height) / 2
            );
          },
        });
        klinecharts.registerIndicator({
          name: "customIndicatorCustomFigure",
          figures: [
            {
              key: "close",
              type: "diamond",
              attrs: ({ coordinate, barSpace }) => {
                return {
                  x: coordinate.current.x,
                  y: coordinate.current.close,
                  width: barSpace.gapBar,
                  height: barSpace.gapBar,
                };
              },
              styles: () => ({ color: "#a0a7e6" }),
            },
          ],
          calc: (dataList) => dataList,
        });
        
        chart.createIndicator("MA", false, { id: "candle_pane" });
        chart.createIndicator("VOL");
        chart.createIndicator("customIndicatorBasic");
        chart.createIndicator("customIndicatorCustomFigure");

        fetch("https://klinecharts.com/datas/kline.json")
          .then((res) => res.json())
          .then((dataList) => {
            chart.applyNewData(dataList);
            chart.resize();
          });
      };
    </script>
  </body>
</html>
